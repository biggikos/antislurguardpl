<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>AntiSlurGuard — руководство пользователя</title>
</head>
<body>
  <h1>AntiSlurGuard — полное руководство</h1>
  <p>Этот документ описывает работу фильтра, настройку наказаний и ежедневное использование. Он рассчитан на администраторов серверов и должен давать понятные ответы без лишних технических деталей.</p>

  <h2>Что делает плагин</h2>
  <ul>
    <li>Проверяет чат и ники на совпадение с запрещёнными выражениями.</li>
    <li>Нормализует обфускации (замены букв, повторения, диакритика) перед проверкой, чтобы ловить обходы.</li>
    <li>Позволяет создавать исключения, чтобы нужные слова всегда проходили.</li>
    <li>Применяет настраиваемые наказания и ведёт учёт нарушений.</li>
    <li>Сообщает игрокам причину блокировки и уведомляет администраторов.</li>
    <li>Сдерживает спам через слоумод и отслеживание повторов.</li>
    <li>Показывает статистику блокировок и может автоматически выдавать перманентный бан при повторных нарушениях.</li>
    <li>Поддерживает плановые рассылки сообщений игрокам.</li>
  </ul>

  <h2>Первичная настройка</h2>
  <ol>
    <li>Запустите сервер с плагином, чтобы создались все файлы внутри папки <code>plugins/AntiSlurGuard</code>.</li>
    <li>Откройте <code>banned-patterns.txt</code> и внесите запрещённые слова или регулярные выражения, по одному на строку. Строки с <code>#</code> считаются комментариями.</li>
    <li>Если есть формулировки, которые нельзя блокировать, добавьте их в <code>exceptions.txt</code>.</li>
    <li>В файле <code>config.yml</code> настройте наказания, уведомления, анти-спам и пути к файлам. После правок используйте <code>/asg reload</code>, чтобы применить изменения.</li>
    <li>Проверьте работу через <code>/asg test &lt;текст&gt;</code>: команда покажет нормализованную строку и совпавший паттерн.</li>
  </ol>

  <h2>Основные файлы</h2>
  <ul>
    <li><strong>banned-patterns.txt</strong> — список запретов. Регулярные выражения и простые слова размещаются здесь.</li>
    <li><strong>exceptions.txt</strong> — белый список фраз, которые должны проходить проверку.</li>
    <li><strong>config.yml</strong> — все параметры плагина: наказания, уведомления, слоумод, пути к файлам.</li>
    <li><strong>messages.yml</strong> — тексты сообщений для игроков и администраторов.</li>
    <li><strong>admin-notify.yml</strong> — личные настройки оповещений администраторов.</li>
    <li><strong>player-stats.yml</strong> — накопленные счётчики нарушений и перманентных банов.</li>
    <li><strong>userdata/</strong> — журналы заблокированных сообщений по каждому игроку.</li>
    <li><strong>runtime-settings.yml</strong> — временные переопределения длительности наказаний.</li>
    <li><strong>announcements.yml</strong> — записи для автоматических рассылок.</li>
    <li><strong>lang/</strong> — языковые файлы, из которых берутся переводы сообщений и комментариев.</li>
  </ul>

  <h2>Настройка фильтра</h2>
  <p>В блоке <strong>patterns</strong> файла <code>config.yml</code> указываются параметры работы паттернов. Ключевые возможности:</p>
  <ul>
    <li><strong>autoVariants</strong> — автоматическое добавление вариантов для простых слов (замены символов, разделители), чтобы ловить leetspeak.</li>
    <li><strong>checkNicknames</strong> и <strong>checkChat</strong> — включение проверки никнеймов и чата отдельно.</li>
  </ul>
  <p>Нормализация задаётся блоком <strong>normalize</strong>. Можно включать или отключать приведение регистра, удаление диакритики, замену повторов, карту символов и транслитерацию. Нормализация помогает распознавать обфускации перед сопоставлением с паттернами.</p>

  <h2>Наказания</h2>
  <p>Для никнеймов и для чата настраиваются отдельные действия. Доступные варианты:</p>
  <ul>
    <li><strong>NONE</strong> — зафиксировать нарушение без дополнительных действий.</li>
    <li><strong>DISALLOW</strong> — запретить сообщение или ник без кика.</li>
    <li><strong>KICK</strong> — выгнать игрока с причиной.</li>
    <li><strong>BAN</strong> — выдать перманентный бан.</li>
    <li><strong>TEMPBAN</strong> — временный бан на указанное количество секунд.</li>
    <li><strong>MUTE</strong> — лишить игрока возможности писать в чат на указанное время.</li>
    <li><strong>COMMAND</strong> — выполнить свою команду. Можно использовать плейсхолдеры <code>{player}</code>, <code>{match}</code>, <code>{type}</code>, <code>{reason}</code>, <code>{durationSeconds}</code>.</li>
  </ul>
  <p>Длительность временных наказаний задаётся в секундах в блоках <strong>durations.chatSeconds</strong> и <strong>durations.nicknameSeconds</strong>. Если нужно временно изменить длительность без редактирования основного конфига, используйте файл <code>runtime-settings.yml</code>.</p>
  <p>Для интеграции с готовыми командами (например, от Essentials) есть шаблоны выполнения кика, бана, мута и временного бана. Они настраиваются в блоке <strong>essentials</strong> или через собственные команды в режиме <strong>COMMAND</strong>.</p>

  <h2>Уведомления и сообщения</h2>
  <ul>
    <li><strong>notifications.player</strong> — сообщение, которое увидит нарушитель, когда его сообщение или ник заблокированы.</li>
    <li><strong>notifications.admin</strong> — оповещение для администраторов о факте блокировки.</li>
    <li><strong>console</strong> — периодический вывод суммарной статистики в консоль. Настройте интервал и порог, при котором агрегированный отчёт отправляется.</li>
  </ul>
  <p>Тексты в <code>messages.yml</code> можно менять под стиль вашего сервера. Администратор может отключить личные уведомления командой <code>/asg notify &lt;ник|me&gt; off</code>; настройки сохраняются в <code>admin-notify.yml</code>.</p>

  <h2>Анти-спам и слоумод</h2>
  <p>Раздел <strong>antiSpam</strong> отвечает за защиту от повторов и спама:</p>
  <ul>
    <li><strong>repeatWindowSeconds</strong> — период, в котором отслеживаются повторяющиеся сообщения.</li>
    <li><strong>repeatThreshold</strong> — сколько одинаковых сообщений допускается до включения слоумода.</li>
    <li><strong>slowmodeDurationSeconds</strong> — сколько времени будет активен персональный слоумод.</li>
    <li><strong>slowmodeDelaySeconds</strong> — минимальный интервал между сообщениями, пока слоумод включён.</li>
  </ul>
  <p>Если слоумод сработал ошибочно, снимите его командой <code>/asg slowmode &lt;ник&gt; clear</code>.</p>

  <h2>Статистика и автобан</h2>
  <p>Когда включено отслеживание, каждое нарушение чата записывается в <code>player-stats.yml</code>. При превышении заданного порога <strong>autoPermaBanThreshold</strong> плагин автоматически выдаёт перманентный бан с причиной из параметра <strong>auto-permaban-reason</strong>. Все заблокированные сообщения сохраняются в личных файлах внутри папки <code>userdata</code>, что помогает разбирать спорные ситуации.</p>

  <h2>Команды</h2>
  <ul>
    <li><strong>/asg help</strong> — список подкоманд и краткие описания.</li>
    <li><strong>/asg reload</strong> — применить изменения в конфигурации, сообщениях и паттернах.</li>
    <li><strong>/asg stats</strong> или <strong>/asg stats &lt;ник&gt;</strong> — показать текущие блокировки или статистику конкретного игрока.</li>
    <li><strong>/asg test &lt;текст&gt;</strong> — проверить, как фильтр нормализует строку и какой паттерн сработает.</li>
    <li><strong>/asg add &lt;паттерн&gt;</strong> и <strong>/asg remove &lt;паттерн&gt;</strong> — редактировать список запрещённых выражений без перезапуска.</li>
    <li><strong>/asg except add|remove &lt;текст&gt;</strong> — управлять белым списком.</li>
    <li><strong>/asg notify &lt;ник|me&gt; on|off|toggle</strong> — включить или выключить личные админ-оповещения.</li>
    <li><strong>/asg logs &lt;ник&gt;</strong> — вывести историю нарушений и заблокированные сообщения игрока.</li>
    <li><strong>/asg unmute &lt;ник&gt;</strong> и <strong>/asg unban &lt;ник&gt;</strong> — выполнить заранее заданные команды для снятия наказаний.</li>
    <li><strong>/asg slowmode &lt;ник&gt; clear</strong> — убрать персональный слоумод.</li>
  </ul>

  <h2>Рассылки</h2>
  <p>Повторяющиеся сообщения настраиваются в <code>announcements.yml</code>. Для каждой записи укажите текст, интервал в секундах и при необходимости подсказку при наведении, ссылку для перехода и требуемое разрешение. Если интервал не указан, используется значение по умолчанию из блока <strong>announcements</strong> в <code>config.yml</code>.</p>

  <h2>Практические советы</h2>
  <ul>
    <li>После добавления новых паттернов или исключений всегда выполняйте <code>/asg reload</code>.</li>
    <li>Перед публикацией изменений проверяйте их через <code>/asg test</code>, чтобы убедиться, что нормализация ловит обходы, а нужные слова не блокируются.</li>
    <li>Если в консоли появляются предупреждения о пустых паттернах, убедитесь, что <code>banned-patterns.txt</code> не пуст и не состоит только из комментариев.</li>
    <li>Сообщайте игрокам причину блокировки: это снижает количество вопросов и споров.</li>
    <li>Используйте <code>exceptions.txt</code> для названий проектов, мемов или служебных сообщений, которые часто ошибочно попадают под фильтр.</li>
  </ul>
</body>
</html>
